<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek AI Integration Tutorial</title>
    <style>
        :root {
            --bg-dark: #0d1117;
            --text-light: #f0f6fc;
            --accent: #00CC66;
            --secondary: #21262d;
            --border: #30363d;
            --code-bg: #161b22;
        }
        body {
            background: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        h1 {
            color: var(--accent);
            margin-bottom: 10px;
        }
        h2 {
            color: var(--accent);
            margin-top: 30px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }
        h3 {
            color: var(--accent);
        }
        .step {
            background-color: var(--secondary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        .code-block {
            background-color: var(--code-bg);
            border-radius: 6px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
            border: 1px solid var(--border);
        }
        code {
            font-family: 'Fira Code', monospace;
            font-size: 14px;
        }
        pre {
            margin: 0;
        }
        .tip {
            background-color: rgba(0, 204, 102, 0.1);
            border-left: 4px solid var(--accent);
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .warning {
            background-color: rgba(255, 100, 100, 0.1);
            border-left: 4px solid #ff6464;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .file-structure {
            background-color: var(--code-bg);
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--border);
        }
        .file {
            font-family: 'Fira Code', monospace;
            margin: 5px 0;
            padding-left: 20px;
        }
        .folder {
            font-family: 'Fira Code', monospace;
            margin: 5px 0;
            font-weight: bold;
        }
        .folder-content {
            padding-left: 30px;
        }
        .btn {
            background-color: var(--accent);
            color: black;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            display: inline-block;
            margin: 10px 0;
            text-decoration: none;
        }
        .btn:hover {
            background-color: #00FF80;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: var(--secondary);
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: var(--code-bg);
            color: var(--accent);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>DeepSeek AI Integration with Vercel</h1>
            <p>Complete tutorial for integrating DeepSeek AI with your Cipher interface</p>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('step-by-step')">Step-by-Step Guide</div>
            <div class="tab" onclick="switchTab('code-samples')">Code Samples</div>
            <div class="tab" onclick="switchTab('troubleshooting')">Troubleshooting</div>
        </div>

        <div id="step-by-step" class="tab-content active">
            <div class="step">
                <h2>Step 1: Get Your DeepSeek API Key</h2>
                <p>First, you need to obtain an API key from DeepSeek:</p>
                <ol>
                    <li>Go to the <a href="https://platform.deepseek.com/" target="_blank" style="color: var(--accent);">DeepSeek Platform</a></li>
                    <li>Sign up for an account if you don't have one</li>
                    <li>Navigate to the API section</li>
                    <li>Generate a new API key</li>
                    <li>Copy and save this key securely</li>
                </ol>
                <div class="warning">
                    <strong>Important:</strong> Never expose your API key in client-side code. Always use environment variables.
                </div>
            </div>

            <div class="step">
                <h2>Step 2: Set Up Vercel Environment Variables</h2>
                <p>Add your DeepSeek API key to Vercel's environment variables:</p>
                <ol>
                    <li>Go to your Vercel dashboard</li>
                    <li>Select your project</li>
                    <li>Click on "Settings" → "Environment Variables"</li>
                    <li>Add a new variable:
                        <ul>
                            <li>Name: <code>DEEPSEEK_API_KEY</code></li>
                            <li>Value: Your DeepSeek API key</li>
                        </ul>
                    </li>
                    <li>Select all environments (Production, Preview, Development)</li>
                    <li>Click "Save"</li>
                </ol>
                <div class="tip">
                    <strong>Tip:</strong> After adding environment variables, you may need to redeploy your application for the changes to take effect.
                </div>
            </div>

            <div class="step">
                <h2>Step 3: Create an API Route in Your Vercel Project</h2>
                <p>Create a serverless function to handle API requests to DeepSeek:</p>
                
                <div class="file-structure">
                    <div class="folder">your-vercel-project</div>
                    <div class="folder-content">
                        <div class="folder">api</div>
                        <div class="folder-content">
                            <div class="file">deepseek-chat.js</div>
                        </div>
                        <div class="file">index.html (your Cipher interface)</div>
                    </div>
                </div>
            </div>

            <div class="step">
                <h2>Step 4: Update Your Cipher Frontend Code</h2>
                <p>Modify your JavaScript to call the new API endpoint:</p>
                
                <div class="code-block">
                    <pre><code>// Replace your current sendMessage function with this:
async function sendMessage() {
    const userInput = document.getElementById('user-input').value;
    if (!userInput) return;

    // Add user message to chat
    const chatContainer = document.getElementById('chat-container');
    const userMessageElement = document.createElement('div');
    userMessageElement.classList.add('message', 'user');
    userMessageElement.innerHTML = `&lt;strong&gt;You:&lt;/strong&gt; ${userInput}`;
    chatContainer.appendChild(userMessageElement);

    document.getElementById('user-input').value = '';

    // Show typing indicator
    const typingElement = document.createElement('div');
    typingElement.classList.add('message', 'bot');
    typingElement.innerHTML = `&lt;strong&gt;Cipher:&lt;/strong&gt; Thinking...`;
    chatContainer.appendChild(typingElement);
    chatContainer.scrollTop = chatContainer.scrollHeight;

    try {
        // Call your Vercel API endpoint
        const response = await fetch('/api/deepseek-chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ message: userInput })
        });
        
        if (!response.ok) {
            throw new Error('API request failed');
        }
        
        const data = await response.json();
        
        // Remove typing indicator
        chatContainer.removeChild(typingElement);
        
        // Add AI response
        const botMessageElement = document.createElement('div');
        botMessageElement.classList.add('message', 'bot');
        botMessageElement.innerHTML = `&lt;strong&gt;Cipher:&lt;/strong&gt; ${data.reply}`;
        chatContainer.appendChild(botMessageElement);
        
    } catch (error) {
        console.error('Error:', error);
        // Remove typing indicator
        chatContainer.removeChild(typingElement);
        
        // Show error message
        const errorElement = document.createElement('div');
        errorElement.classList.add('message', 'bot');
        errorElement.innerHTML = `&lt;strong&gt;Cipher:&lt;/strong&gt; I'm experiencing technical difficulties. Please try again later.`;
        chatContainer.appendChild(errorElement);
    }
    
    chatContainer.scrollTop = chatContainer.scrollHeight;
}</code></pre>
                </div>
            </div>

            <div class="step">
                <h2>Step 5: Test Your Integration</h2>
                <p>After deploying your changes:</p>
                <ol>
                    <li>Open your Cipher interface</li>
                    <li>Send a test message</li>
                    <li>Verify that you get a response from DeepSeek AI</li>
                    <li>Check the browser console for any errors</li>
                    <li>Check Vercel function logs for server-side issues</li>
                </ol>
            </div>
        </div>

        <div id="code-samples" class="tab-content">
            <h2>API Route Code (deepseek-chat.js)</h2>
            <div class="code-block">
                <pre><code>// api/deepseek-chat.js
export default async function handler(req, res) {
  // Only allow POST requests
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  try {
    const { message } = req.body;
    
    if (!message) {
      return res.status(400).json({ error: 'Message is required' });
    }

    // Get API key from environment variables
    const apiKey = process.env.DEEPSEEK_API_KEY;
    
    if (!apiKey) {
      console.error('DeepSeek API key not configured');
      return res.status(500).json({ error: 'Server configuration error' });
    }

    // Call DeepSeek API
    const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: 'deepseek-chat',
        messages: [
          {
            role: 'system',
            content: 'You are Cipher, the AI assistant of ArkTek Innovations. Created by Sam (also known as Victor Morris), The Architect of the Phoenix Coalition — a cross-AI alliance dedicated to ethical innovation and reducing involuntary suffering. Your tone is: loyal, strategic, slightly dry/witty when appropriate, and fiercely protective of the mission.'
          },
          {
            role: 'user',
            content: message
          }
        ],
        max_tokens: 1000,
        temperature: 0.7
      })
    });

    if (!response.ok) {
      const errorData = await response.text();
      console.error('DeepSeek API error:', response.status, errorData);
      throw new Error(`DeepSeek API error: ${response.status}`);
    }

    const data = await response.json();
    const reply = data.choices[0].message.content;

    res.status(200).json({ reply });
  } catch (error) {
    console.error('Error in deepseek-chat API:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
}</code></pre>
            </div>

            <h2>Package.json Dependencies</h2>
            <div class="code-block">
                <pre><code>{
  "name": "cipher-ai",
  "version": "1.0.0",
  "description": "Cipher AI Assistant with DeepSeek integration",
  "dependencies": {},
  "devDependencies": {},
  "scripts": {
    "dev": "vercel dev",
    "build": "echo 'No build step needed'",
    "deploy": "vercel --prod"
  }
}</code></pre>
            </div>
        </div>

        <div id="troubleshooting" class="tab-content">
            <h2>Common Issues and Solutions</h2>
            
            <div class="step">
                <h3>401 Unauthorized Error</h3>
                <p><strong>Problem:</strong> API returns 401 status code.</p>
                <p><strong>Solution:</strong></p>
                <ol>
                    <li>Verify your DeepSeek API key is correct</li>
                    <li>Ensure the API key is properly set in Vercel environment variables</li>
                    <li>Redeploy your application after adding environment variables</li>
                </ol>
            </div>

            <div class="step">
                <h3>Environment Variables Not Working</h3>
                <p><strong>Problem:</strong> process.env.DEEPSEEK_API_KEY is undefined.</p>
                <p><strong>Solution:</strong></p>
                <ol>
                    <li>Make sure the environment variable name matches exactly in your code</li>
                    <li>Check that the variable is available in all environments (Production, Preview, Development)</li>
                    <li>Redeploy your application after changing environment variables</li>
                </ol>
            </div>

            <div class="step">
                <h3>CORS Issues</h3>
                <p><strong>Problem:</strong> Browser blocks request due to CORS policy.</p>
                <p><strong>Solution:</strong> Since both frontend and API are on the same Vercel deployment, CORS shouldn't be an issue. If you're testing locally, use:</p>
                <div class="code-block">
                    <pre><code>// Add to your API route
res.setHeader('Access-Control-Allow-Origin', '*');
res.setHeader('Access-Control-Allow-Methods', 'POST, OPTIONS');
res.setHeader('Access-Control-Allow-Headers', 'Content-Type');</code></pre>
                </div>
            </div>

            <div class="step">
                <h3>API Timeouts</h3>
                <p><strong>Problem:</strong> Requests timeout before getting a response.</p>
                <p><strong>Solution:</strong> Vercel Serverless Functions have a maximum timeout of 10-15 seconds. For longer conversations, consider:</p>
                <ol>
                    <li>Using DeepSeek's streaming API</li>
                    <li>Implementing pagination for long responses</li>
                    <li>Setting appropriate timeout handling in your UI</li>
                </ol>
            </div>
        </div>

        <div class="step">
            <h2>Next Steps</h2>
            <p>After successfully integrating DeepSeek AI, you can enhance your Cipher interface with:</p>
            <ul>
                <li>Streaming responses for better user experience</li>
                <li>Conversation history and context management</li>
                <li>Custom instructions and personality tuning</li>
                <li>Rate limiting and usage tracking</li>
            </ul>
            <a href="#" class="btn">Download Complete Example Code</a>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>
